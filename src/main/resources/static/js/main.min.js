function objectifyForm(a){var c,b={};for(c=0;c<a.length;c++)b[a[c]["name"]]=a[c]["value"];return b}function getCookie(a){var b,c=new RegExp("(^| )"+a+"=([^;]*)(;|$)");return(b=document.cookie.match(c))?unescape(b[2]):null}function writeCookie(a,b,c){var d=new Date;d.setTime(d.getTime()+1e3*60*60*24*c),document.cookie=a+"="+escape(b)+";expires="+d.toGMTString()}const COOKIE_SUBMIT_NAME="U_ARE_SUBMIT_";!function(a){function b(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a}function c(a){this.options=b({},this.options),b(this.options,a),this._init()}c.prototype.options={wrapper:document.body,message:"yo!",layout:"growl",effect:"slide",type:"error",ttl:6e3,onClose:function(){return!1},onOpen:function(){return!1}},c.prototype._init=function(){this.ntf=document.createElement("div"),this.ntf.className="ns-box ns-"+this.options.layout+" ns-effect-"+this.options.effect+" ns-type-"+this.options.type,this.ntf.innerHTML='<div class="ns-box-inner">'+this.options.message+'</div><span class="ns-close"></span></div>',this.options.wrapper.insertBefore(this.ntf,this.options.wrapper.firstChild);var a=this;this.dismissttl=setTimeout(function(){a.active&&a.dismiss()},this.options.ttl),this._initEvents()},c.prototype._initEvents=function(){var a=this;this.ntf.querySelector(".ns-close").addEventListener("click",function(){alert(22),a.dismiss()})},c.prototype.show=function(){this.active=!0,this.ntf.classList.remove("ns-hide"),this.ntf.classList.add("ns-show"),this.options.onOpen()},c.prototype.dismiss=function(){var b,a=this;this.active=!1,clearTimeout(this.dismissttl),this.ntf.classList.remove("ns-show"),setTimeout(function(){a.ntf.classList.add("ns-hide"),a.options.onClose()},25),b=function(c){return c.target!==a.ntf?!1:(this.removeEventListener("animationend",b),a.options.wrapper.removeChild(this),void 0)},this.ntf.addEventListener("animationend",b)},a.NotificationFx=c}(window),$(document).ready(function(){var b,c;localStorage&&localStorage.clear(),$("#loc_city").select2();const a=new Vue({el:"#app",data:{page:1,records:[],loading:!0},methods:{queryRecords:function(){var a=this;a.loading=!0,axios.get("/records/"+this.page).then(function(b){$("#app .loader").hide();var c=b.data.payload;return 0==c.length?($(".mdui-snackbar").remove(),mdui.snackbar({message:"没有数据了~"}),void 0):(a.records=a.records.concat(c),a.loading=!1,void 0)}).catch(function(a){console.log(a)})},doStar:function(a,b){b&&axios.post("/star/"+a).then(function(a){if(a.data&&a.data.success){var c=$(b.target).parents(".card-footer").find(".star").text();$(b.target).parents(".card-footer").find(".star").text(parseInt(c)+1),mdui.snackbar({message:"为他点赞成功"})}else mdui.snackbar({message:a.data.msg||"点赞失败"})}).catch(function(a){console.log(a)})},loadMore:function(){this.page+=1,this.queryRecords()},reload:function(){var a=this;axios.get("/records/"+this.page).then(function(b){var c=b.data.payload;return 0==c.length?($(".mdui-snackbar").remove(),mdui.snackbar({message:"没有数据了~"}),void 0):(a.records=c,void 0)}).catch(function(a){console.log(a)})}},mounted:function(){this.queryRecords()}});b=new mdui.Dialog("#record-dialog"),$("a.talk-about").click(function(){b.open()}),$(".mdui-dialog-actions #record-btn").click(function(){if(getCookie(COOKIE_SUBMIT_NAME))return mdui.snackbar({message:"您已经提交过，明天再来吧!"}),void 0;var c=objectifyForm($(".mdui-dialog-content form").serializeArray());$.ajax({url:"/record",type:"POST",data:JSON.stringify(c),contentType:"application/json; charset=utf-8",dataType:"json",success:function(c){c&&c.success?(localStorage&&localStorage.clear(),mdui.snackbar({message:"记录成功"}),b.close(),a.reload()):mdui.snackbar({message:c.msg||"记录失败"})}})}),c=document.getElementById("record-dialog"),c.addEventListener("opened.mdui.dialog",function(){$(".mdui-dialog-content form").sisyphus({locationBased:!0,timeout:3,onSave:function(){console.log("Auto saved: ",new Date)}})})});